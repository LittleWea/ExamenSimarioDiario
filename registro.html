<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- jQuery Validate -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <!-- Incluir HoldOn.js desde CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/holdonjs@1.1.0/dist/HoldOn.min.css">
    <link rel="stylesheet" href="HoldOn.min.css">

</head>

<body>
    <div class="container mt-5">
        <h2 class="text-center">Formulario de Registro</h2>
        <form>
            <div class="form-group">
                <label for="rfc">RFC</label>
                <input type="text" class="form-control" id="rfc" placeholder="Ingrese su RFC" required>
            </div>
            <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" class="form-control" id="nombre" placeholder="Ingrese su nombre" required>
            </div>
            <div class="form-group">
                <label for="apPaterno">Apellido Paterno</label>
                <input type="text" class="form-control" id="apPaterno" placeholder="Ingrese su apellido paterno"
                    required>
            </div>
            <div class="form-group">
                <label for="apMaterno">Apellido Materno</label>
                <input type="text" class="form-control" id="apMaterno" placeholder="Ingrese su apellido materno"
                    required>
            </div>
            <div class="form-group">
                <label for="edad">Edad</label>
                <input type="number" class="form-control" id="edad" placeholder="Ingrese su edad" required>
            </div>
            <div class="form-group">
                <label for="telefono">Teléfono</label>
                <input type="tel" class="form-control" id="telefono" placeholder="Ingrese su teléfono" required>
            </div>
            <div class="form-group">
                <label for="correo">Correo Electrónico</label>
                <input type="email" class="form-control" id="correo" placeholder="Ingrese su correo electrónico"
                    required>
            </div>
            <div class="form-group">
                <label for="contrasena">Contraseña</label>
                <input type="password" class="form-control" id="contrasena" placeholder="Ingrese su contraseña"
                    required>
            </div>
            <button id="btnRegistrar" class="btn btn-primary btn-block">Registrarse</button>
        </form>
    </div>
    <br>
    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script src="HoldOn.min.js"></script>

    <!-- Incluir Notify.js desde CDN -->
    <script src="notify.js"></script>
    <script src="notify.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#btnRegistrar").click(function (e) {
                e.preventDefault()
                var regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                if ($("#rfc").val() !== '' && $("#nombre").val() !== '' && $("#apPaterno").val() !== '' && $("#apMaterno").val() !== '' &&
                    $("#edad").val() !== '' && $("#telefono").val() !== '' && ($("#correo").val() !== '' && regex.test($("#correo").val())) && $("#contrasena").val() !== '') {
                    HoldOn.open({
                        theme: "sk-cube-grid"
                    })

                    $.ajax({
                        url: 'http://localhost:3000/usuario/create',
                        type: 'POST',
                        dataType: 'json',
                        data: JSON.stringify({
                            rfc: $("#rfc").val(),
                            contrasena: $("#contrasena").val(),
                            nombre: $("#nombre").val(),
                            apPaterno: $("#apPaterno").val(),
                            apMaterno: $("#apMaterno").val(),
                            edad: $("#edad").val(),
                            telefono: $("#telefono").val(),
                            correo: $("#correo").val()
                        }),
                        contentType: 'application/json'
                    }).then(function (response) {
                        // Se ejecuta si la solicitud es exitosa
                        if (response.error) {
                            $.notify("Algo fallo: " + response.mensaje, "error");
                        } else {
                            // window.location.href = 'http://localhost/loginusers.html';
                            console.log('Éxito:', response);
                            $.notify("Se creo el usuario con exito", "success");
                        }
                    }).always(function () {
                        // Se ejecuta siempre, sin importar si fue éxito o error
                        HoldOn.close()
                        console.log('La solicitud ha finalizado.');
                    });
                } else {
                    $.notify("Rellena todos los campos", "error");
                }

            })
        })
    </script>

</body>

</html>